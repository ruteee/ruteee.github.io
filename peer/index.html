<html>
<head>
    <title>PeerJS - Video chat example</title>
    <link rel="stylesheet" href="style.css">


        <script src="https://code.jquery.com/jquery-2.2.4.min.js"integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="crossorigin="anonymous"></script>

        <script type="text/javascript" src="peer.js"></script>
    
    <script>
    // Compatibility shim
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

    var peer;
    var cadeia128 = 'viokc9kUZEaXimXJHTKRsMn2m46OFuln8ByXWwhjxxS4xBL3AwVhAIDiI9q25QlqTzS2E3Cwrez8ZpOrGWLeWuHqQoC6AhqSLYfIuy0jreutbZJJHinlCApGob9Q5WGy';
    
    var cadeia256 = '2kaK5SX7PYcMF4BwRPatbRQPcELxuw8qAzyLQKPcyKJ1tcNUeEY4NIeSkI5UNWUtHwKRrAMMnNp0XcDrv1ijsgXb8sYabTvp09JDl60Z6D7yVMrRBhGoFGiDZOlsKr4fZ2m3vQfeoYjnCryGXEBfwLFA8jRWw0wBcoNbOYhhqLrWEWHnFk92WhXZGBuauUoDbz1G5vxSwpWszkSQeuwTuYKHBfYmriCR8ovMaquQYvTEzRsJ8wU4DeqKIF63ek6E';

    var cadeia512 = 'L9WlGJHXWc4ht5n0vXop0oTxEQOs0s0NreVxDK9bWvRaRl0gJTzlFNLF9rDClaLWx4E5AHHeBj6fnkNYrzPHSgCHqUUzCGjH1AgSL8fWzuZN6F4xr4YHqt1svZ1yWwVhh4w00TYbG3OQYW18WuorJMZF4atwJOiyxnEfnNfD1FLe3aLXa2t8GB8nVEqU0HAkquPLtzswIHvHLRpyRrupjr2RlQOjjyY5pCySP8pcwOLB5C8IDoVfgcnHhKtmRCCKiMgGL5xwJM34kI5hOvuiwWROG03THODL0iRSs9CSLL3fe3ZN5hFRwtFCMnzFZ431s11A2kwumsjqlRUBpDMIcelZSuKuafaX6iNh7otROTPcZTuENKiAUlgICJ95FjMN0NmqQ3f1VnNKrgIt9QM4QaouDLAb7eGfNlcGpbp7Gs5Z9xfEobPotzrYeyv0yrvcSXaFBpQJxHxAtBO291zVwstyBTHZ1xUNcHITPHCRjTo3a4QnE5gjiQ6aSuxpIa9v';


    cadeia1024 = 'v8J0kOx8R4VLRqgfiXRHQrNEsWiflW0bLlpt3aivQa9goaMjgU5CwsaDMbKRkGFZELgkto7BJLn6WyeSZtRTSk6fw00J00XDsMcTBMwMVStklmbP1UWPlJzOx0MXiW3G2RJMznIt1PSqXr1pVerjEUhyTT8qDpc5xFDHstlthDfoxQXKG3NwG8Vuy1tkjU7vAvbfYMZzbgzRfC70b4SI8eRrZ2M7nOux2DGVOfccH2xGyB5V3vSp1DMl6DensYu4aZqn3hfHnLZiNXmYWXFWKY6LW0SfstbGQ0PXHNh1BxgItDMFgAnWzjj5Gr0mXTFT7iMUb1fspqWRuODPWKNxmkLFVHJihHPu1B9rx4XkriwkLwXPtGRF9uHRuLPxK4Ye5cnrIm5BaO0qoH1z0ek60qEjfbjJIb3iLkI01q1CcRqp8PlFraGzPxcvkIwSB2soRK2sjwrORUv1WeBZDpJC8cFr5jkE6VKEVs9kap8WG0iIvfEkM4mJf8VnyH8RAHAu52anqm5WHZNlkAownmJgw50SyQP1KpWmInatLalsaeSqtynHkpbbZE4Rq0RbDiQjJcz2wtMgYaB4e546a3I6j5IxsYCjDl2xkS1vbeXe5bBuk8D9asOE1fkGh2aTVo8VRiqNAvLsvZ3zPoJlf62nzMn2PCa3jSO8FnVUYhv0GQJuWzupeYBj6qTpqAOkz3fQFiVMYkwCkJIxcJju533qaWVq05mSkpjAOBY3mZM3iMkUcJJwhvAvRE0AskHhuSSXcRb7fSwXSmLGz7t5ZsmQ4LgrBs8WT0vRssExy2G0yK2hWPOWgQWpyYXCGYwq9hco2AfXDyDmXcSFvMcS26wcOFRGJsJfnDhBHzD8uRPftGX2CQlnsUngL0RKhm3ECHE2r1o6QSPvGUyMfQHpTXtUWlFwDh1e0mJFqrDcPSTYGbkqmIyB4wnXqz9kZ62bVqcTbY6CLL12cvti5EcseeJj3aFLOcUv7ifln7nl2gpibumCSEaZGtZySaAYA3jvfTaR';

    cadeia2096 = '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';

    cadeia4096 = '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';

    var horaSaida ;
    var horaChegada ;
    var connection;
    var count=0;
    var media;
    var tempos = [];


    // Click handlers setup
    $(document).ready(function(){
        // PeerJS object
        $("#create-peer").click(function() {
            console.log($("#your-id").val());
            peer = new Peer("" + $("#your-id").val(), {　host:'peerjs-server.herokuapp.com', secure:true, port:443, key: 'peerjs', debug: 3})

            peer.on('open', function(){
                $('#my-id').text(peer.id);
            });

            // Receiving a call

            peer.on("connection", function(conn){
                    console.log("recebeu conexao");
                    connection = conn;
                    connection.on('data', function(data){
                    connection.send(data);
                    console.log("Recebi a msg")
                });

            })
          
            peer.on('error', function(err){
                alert(err.message);
                // Return to step 2 if error occurs
                step2();
            });
        });


        $('#make-call').click(function(){
            // Initiate a call!
            connection = peer.connect($('#callto-id').val(), {realiable: true});
            
            
            connection.on('open', function(){
                 onConnectSetup(connection);

                horaSaida = performance.now();
                 connection.send(cadeia1024);
                
            })
           
           
            
        });

        $('#end-call').click(function(){
            connection.close();
            step2();
        });

        // Retry if getUserMedia fails
        $('#step1-retry').click(function(){
            $('#step1-error').hide();
            step1();
        });

        // Get things started
        step1();
    });

    function step1 () {
        // Get audio/video stream
        navigator.getUserMedia({audio: true, video: true}, function(stream){
            // Set your video displays
            $('#my-video').prop('src', URL.createObjectURL(stream));
            step2();
        }, function(){ $('#step1-error').show(); });
    }

    function step2 () {
        $('#step1, #step3').hide();
        $('#step2').show();
    }

    function onConnectSetup (conn) {
        var tempoGasto;
        var tempoChegada;
        conn.on('data', function(data){
                
            if(count < 100){
                horaChegada = performance.now();

               tempoGasto = (horaChegada - horaSaida)/2;
               tempos[count] = tempoGasto;
               count++;

               horaSaida = performance.now();
               conn.send(data);

                
            }else{
                var sum =0;
                for(var i = 0; i <count; i++)
                    sum += tempos[i];
                
                console.log('tempo médio estimado', sum/(count));
            }
        })

    }
    </script>


</head>

<body>

    <div class="pure-g">

        <!-- Video area -->
        <div class="pure-u-2-3" id="video-container">
            <video id="their-video" autoplay></video>
            <video id="my-video" muted="true" autoplay></video>
        </div>

        <!-- Steps -->
        <div class="pure-u-1-3">
            <h2>PeerJS Video Chat</h2>
            <div class="pure-form">
                <input type="text" placeholder="Your id..." id="your-id">
                <a href="#" class="pure-button pure-button-success" id="create-peer">Create Peer</a>
            </div>

            <!-- Get local audio/video stream -->
            <div id="step1">
                <p>Please click `allow` on the top of the screen so we can access your webcam and microphone for calls.</p>
                <div id="step1-error">
                    <p>Failed to access the webcam and microphone. Make sure to run this demo on an http server and click allow when asked for permission by the browser.</p>
                    <a href="#" class="pure-button pure-button-error" id="step1-retry">Try again</a>
                </div>
            </div>

            <!-- Make calls to others -->
            <div id="step2">
                <p>Your id: <span id="my-id">...</span></p>
                <p>Share this id with others so they can call you.</p>
                <h3>Make a call</h3>
                <div class="pure-form">
                    <input type="text" placeholder="Call user id..." id="callto-id">
                    <a href="#" class="pure-button pure-button-success" id="make-call">Call</a>
                </div>
            </div>

            <!-- Call in progress -->
            <div id="step3">
                <p>Currently in call with <span id="their-id">...</span></p>
                <p><a href="#" class="pure-button pure-button-error" id="end-call">End call</a></p>
            </div>
        </div>
    </div>




</body>
</html>
